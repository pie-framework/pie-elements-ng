version: 1

component:
  element: "@pie-elements-ng/media"
  framework: "svelte"

examplesApp:
  app: "@pie-demos/sveltekit"
  routeTemplate: "/demos/<tagName>"

evals:
  # ==========================================================================
  # Basic Rendering - Video
  # ==========================================================================
  - id: "media-svelte/default/renders-video-gather"
    sampleId: "default"
    severity: "error"

    intent: "Validates video element renders correctly in gather mode with all UI elements"

    notes:
      - "Should display prompt, video player with controls, and progress tracking"
      - "Video should be interactive with play/pause controls"
      - "Progress bar and time display should be visible"

    steps:
      - action: navigate
        path: "/media"

      - action: observe
        target:
          description: "Prompt text"
          hint: 'text="Watch the video about web accessibility"'
        expected:
          exists: true

      - action: observe
        target:
          description: "Video element"
          hint: 'video'
        expected:
          exists: true

      - action: observe
        target:
          description: "Playback info display"
          hint: '.playback-info'
        expected:
          exists: true

      - action: observe
        target:
          description: "Progress bar"
          hint: '.progress-bar'
        expected:
          exists: true

      - action: axe
        expected:
          maxViolations: 0
          wcagLevel: "AA"

    spiritChecks:
      - "Video player renders with native controls"
      - "Poster image displays before playback"
      - "Time display shows 0:00 / total duration"
      - "Progress bar starts at 0%"

  # ==========================================================================
  # Basic Rendering - Audio
  # ==========================================================================
  - id: "media-svelte/simple-audio/renders-audio"
    sampleId: "simple-audio"
    severity: "error"

    intent: "Validates audio element renders correctly"

    notes:
      - "Should display audio player controls"
      - "No poster or video-specific UI"
      - "Progress tracking still visible"

    steps:
      - action: navigate
        path: "/media"
        params:
          sampleId: "simple-audio"

      - action: observe
        target:
          description: "Audio element"
          hint: 'audio'
        expected:
          exists: true

      - action: observe
        target:
          description: "No video element"
          hint: 'video'
        expected:
          exists: false

      - action: axe
        expected:
          maxViolations: 0
          wcagLevel: "AA"

    spiritChecks:
      - "Audio controls are clearly visible"
      - "Progress tracking works same as video"

  # ==========================================================================
  # User Interactions - Playback Start
  # ==========================================================================
  - id: "media-svelte/default/play-initiates"
    sampleId: "default"
    severity: "error"

    intent: "Validates play button starts playback and updates session"

    notes:
      - "Clicking play should set session.played = true"
      - "Should increment session.playCount"
      - "Time should start advancing"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Video player"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: observe
        target:
          description: "Session shows played status"
          hint: 'pre code'
        expected:
          contains: '"played"'

    spiritChecks:
      - "Video plays smoothly without stuttering"
      - "Time display updates in real-time"
      - "Progress bar fills as video plays"

  # ==========================================================================
  # User Interactions - Completion Tracking
  # ==========================================================================
  - id: "media-svelte/default/completion-tracking"
    sampleId: "default"
    severity: "error"

    intent: "Validates completion is tracked when video reaches end"

    notes:
      - "Sample has requireCompletion: true"
      - "Must reach natural end of video"
      - "Session should have completed: true"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Video player"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 3000

      - action: playMedia
        target:
          description: "Seek near end"
          hint: 'video'
        command: "seekTo"
        seekTime: 58

      - action: wait
        timeout: 5000

      - action: observe
        target:
          description: "Session shows completed"
          hint: 'pre code'
        expected:
          contains: '"completed"'

  # ==========================================================================
  # User Interactions - Progress Percentage
  # ==========================================================================
  - id: "media-svelte/default/progress-percentage"
    sampleId: "default"
    severity: "error"

    intent: "Validates minPlayedPercentage requirement tracking"

    notes:
      - "Sample has minPlayedPercentage: 50"
      - "Must reach at least 50% of video duration"
      - "highestTimeReached tracks maximum point"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Video player"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: playMedia
        target:
          description: "Seek to 50% mark (30 seconds of 60 total)"
          hint: 'video'
        command: "seekTo"
        seekTime: 30

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Progress bar shows at least 50%"
          hint: '.progress-fill'
        expected:
          exists: true

  # ==========================================================================
  # Modes - View Mode
  # ==========================================================================
  - id: "media-svelte/default/view-mode"
    sampleId: "default"
    severity: "error"

    intent: "Validates view mode displays playback state without evaluation"

    notes:
      - "Should show player with current progress"
      - "No evaluation feedback shown"
      - "Progress indicators still visible"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Start playback"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: click
        target:
          description: "View mode"
          hint: 'input[name="mode"][value="view"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Video player exists"
          hint: 'video'
        expected:
          exists: true

      - action: observe
        target:
          description: "No evaluation indicator"
          hint: '.response-indicator'
        expected:
          exists: false

  # ==========================================================================
  # Modes - Evaluate Mode (Requirements Met)
  # ==========================================================================
  - id: "media-svelte/default/evaluate-complete"
    sampleId: "default"
    severity: "error"

    intent: "Validates evaluate mode shows completion when requirements met"

    notes:
      - "Play to end and reach 50% minimum"
      - "Should show green 'Requirements met' indicator"
      - "Score should be 1.0"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Start playback"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: playMedia
        target:
          description: "Seek near end"
          hint: 'video'
        command: "seekTo"
        seekTime: 58

      - action: wait
        timeout: 5000

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Complete indicator"
          hint: '.response-indicator.complete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Requirements met text"
          hint: 'text="Requirements met"'
        expected:
          exists: true

  # ==========================================================================
  # Modes - Evaluate Mode (Requirements Not Met)
  # ==========================================================================
  - id: "media-svelte/default/evaluate-incomplete"
    sampleId: "default"
    severity: "error"

    intent: "Validates evaluate mode shows incomplete when requirements not met"

    notes:
      - "Play only 20% of video (below 50% minimum)"
      - "Should show yellow 'Requirements not met' indicator"
      - "Score should be 0.0"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Start playback"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 1000

      - action: playMedia
        target:
          description: "Pause early"
          hint: 'video'
        command: "pause"

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Incomplete indicator"
          hint: '.response-indicator.incomplete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Requirements not met text"
          hint: 'text="Requirements not met"'
        expected:
          exists: true

  # ==========================================================================
  # Modes - Instructor Rationale
  # ==========================================================================
  - id: "media-svelte/default/instructor-rationale"
    sampleId: "default"
    severity: "error"

    intent: "Validates instructor role displays rationale in evaluate mode"

    notes:
      - "Sample has rationaleEnabled: true"
      - "Rationale should only show for instructor role"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Brief playback"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: click
        target:
          description: "Instructor role"
          hint: 'input[name="role"][value="instructor"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Rationale section visible"
          hint: '.rationale'
        expected:
          exists: true

  # ==========================================================================
  # Configuration - Audio vs Video
  # ==========================================================================
  - id: "media-svelte/simple-audio/audio-specific"
    sampleId: "simple-audio"
    severity: "error"

    intent: "Validates audio-specific configuration and behavior"

    notes:
      - "Sample uses mediaType: 'audio'"
      - "No poster, no video element"
      - "All tracking features still work"

    steps:
      - action: navigate
        path: "/media"
        params:
          sampleId: "simple-audio"

      - action: observe
        target:
          description: "Audio element present"
          hint: 'audio'
        expected:
          exists: true

      - action: playMedia
        target:
          description: "Play audio"
          hint: 'audio'
        command: "play"

      - action: wait
        timeout: 2000

      - action: observe
        target:
          description: "Time display updates"
          hint: '.time-display'
        expected:
          exists: true

  # ==========================================================================
  # Accessibility - Keyboard Navigation
  # ==========================================================================
  - id: "media-svelte/default/keyboard-navigation"
    sampleId: "default"
    severity: "error"

    intent: "Validates full keyboard navigation support"

    notes:
      - "HTML5 video controls are keyboard accessible"
      - "Spacebar for play/pause"
      - "Arrow keys for seeking"
      - "Focus indicators must be visible"

    steps:
      - action: navigate
        path: "/media"

      - action: observe
        target:
          description: "Video is focusable"
          hint: 'video[controls]'
        expected:
          exists: true

      - action: axe
        expected:
          maxViolations: 0
          wcagLevel: "AA"

    spiritChecks:
      - "Tab key focuses the video player"
      - "Spacebar plays/pauses video"
      - "Arrow keys seek forward/backward"
      - "All controls reachable via keyboard"
      - "No keyboard traps"

  # ==========================================================================
  # Accessibility - ARIA Attributes
  # ==========================================================================
  - id: "media-svelte/default/aria-attributes"
    sampleId: "default"
    severity: "error"

    intent: "Validates proper ARIA attributes for accessibility"

    notes:
      - "Video should have aria-label or aria-labelledby"
      - "Playback info should have aria-live for updates"
      - "Progress bar should have role='progressbar'"

    steps:
      - action: navigate
        path: "/media"

      - action: observe
        target:
          description: "Video with ARIA label"
          hint: 'video[aria-label]'
        expected:
          exists: true

      - action: observe
        target:
          description: "Playback info with live region"
          hint: '.playback-info[aria-live="polite"]'
        expected:
          exists: true

      - action: observe
        target:
          description: "Progress bar with role"
          hint: '.progress-bar[role="progressbar"]'
        expected:
          exists: true

    spiritChecks:
      - "Screen readers announce playback state changes"
      - "Progress updates are communicated"
      - "Time remaining is accessible"

  # ==========================================================================
  # Accessibility - Captions Support
  # ==========================================================================
  - id: "media-svelte/default/captions"
    sampleId: "default"
    severity: "warn"

    intent: "Validates caption track availability for accessibility"

    notes:
      - "WCAG 2.2 Level AA requires captions for prerecorded video"
      - "Captions provide accessibility for deaf/hard-of-hearing users"

    steps:
      - action: navigate
        path: "/media"

      - action: observe
        target:
          description: "Video element"
          hint: 'video'
        expected:
          exists: true

    spiritChecks:
      - "Captions are available (check for track element)"
      - "Caption toggle is accessible"
      - "Captions are synchronized with audio"

  # ==========================================================================
  # Error Handling - No Playback
  # ==========================================================================
  - id: "media-svelte/default/no-playback"
    sampleId: "default"
    severity: "error"

    intent: "Validates graceful handling when video never played"

    notes:
      - "User switches to evaluate mode without playing"
      - "Should handle empty session gracefully"
      - "Should show requirements not met"
      - "No JavaScript errors"

    steps:
      - action: navigate
        path: "/media"

      - action: click
        target:
          description: "Evaluate mode without playing"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Incomplete indicator"
          hint: '.response-indicator.incomplete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Element renders without error"
          hint: '.pie-media'
        expected:
          exists: true

  # ==========================================================================
  # State Management - Mode Switching
  # ==========================================================================
  - id: "media-svelte/default/mode-switching"
    sampleId: "default"
    severity: "error"

    intent: "Validates smooth transitions between modes"

    notes:
      - "Should switch between gather, view, evaluate modes"
      - "Session state should persist"
      - "Progress should be maintained"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Play briefly"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: click
        target:
          description: "View mode"
          hint: 'input[name="mode"][value="view"]'

      - action: wait
        timeout: 500

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 500

      - action: click
        target:
          description: "Back to gather"
          hint: 'input[name="mode"][value="gather"]'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "Element stable"
          hint: '.pie-media'
        expected:
          exists: true

  # ==========================================================================
  # State Management - Reset Functionality
  # ==========================================================================
  - id: "media-svelte/default/reset"
    sampleId: "default"
    severity: "error"

    intent: "Validates reset button clears session and returns to initial state"

    steps:
      - action: navigate
        path: "/media"

      - action: playMedia
        target:
          description: "Play video"
          hint: 'video'
        command: "play"

      - action: wait
        timeout: 2000

      - action: click
        target:
          description: "Reset button"
          hint: 'button:has-text("Reset")'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "Progress reset"
          hint: '.time-display'
        expected:
          contains: "0:00"

  # ==========================================================================
  # Performance - Initial Load
  # ==========================================================================
  - id: "media-svelte/default/load-performance"
    sampleId: "default"
    severity: "warn"

    intent: "Validates element loads and renders within acceptable time"

    notes:
      - "Target: < 2s to interactive"
      - "Video metadata should load quickly"

    steps:
      - action: navigate
        path: "/media"

      - action: wait
        condition: "networkidle"

      - action: observe
        target:
          description: "Element rendered"
          hint: '.pie-media'
        expected:
          exists: true

  # ==========================================================================
  # Style & Visual - Color Contrast
  # ==========================================================================
  - id: "media-svelte/default/style-color-contrast"
    sampleId: "default"
    severity: "error"

    intent: "Validates text color contrast meets WCAG 2.2 Level AA standards"

    notes:
      - "WCAG 2.2 AA: Normal text requires 4.5:1 contrast ratio"

    steps:
      - action: navigate
        path: "/media"

      - action: checkColorContrast
        target:
          description: "Prompt text"
          hint: '.prompt'
        expected:
          ratio:
            greaterThanOrEqual: 4.5

      - action: checkColorContrast
        target:
          description: "Time display"
          hint: '.time-display'
        expected:
          ratio:
            greaterThanOrEqual: 4.5

    spiritChecks:
      - "All text is easily readable"
      - "Progress bar has clear visual contrast"

  # ==========================================================================
  # Style & Visual - Visual Regression Baseline
  # ==========================================================================
  - id: "media-svelte/default/style-visual-regression"
    sampleId: "default"
    severity: "warn"

    intent: "Creates visual regression baseline for gather mode"

    notes:
      - "Captures screenshot for future comparisons"
      - "Helps detect unintended visual changes"

    steps:
      - action: navigate
        path: "/media"

      - action: screenshot
        target:
          description: "Media element in gather mode"
          hint: '.pie-media'
        name: "media-svelte-default-gather"

    spiritChecks:
      - "Element renders consistently"
      - "No unexpected layout shifts"
