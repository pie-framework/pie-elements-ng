version: 1

component:
  element: "@pie-elements-ng/upload"
  framework: "svelte"

examplesApp:
  app: "@pie-demos/sveltekit"
  routeTemplate: "/demos/<tagName>"

evals:
  # ==========================================================================
  # Basic Rendering
  # ==========================================================================
  - id: "upload-svelte/default/renders-gather"
    sampleId: "default"
    severity: "error"

    intent: "Validates upload element renders correctly in gather mode with drop zone"

    notes:
      - "Should display prompt, drop zone, and file upload instructions"
      - "Drop zone should be interactive"
      - "Accepted file types and size limits should be shown"

    steps:
      - action: navigate
        path: "/upload"

      - action: observe
        target:
          description: "Prompt text"
          hint: 'text="Upload your assignment files below"'
        expected:
          exists: true

      - action: observe
        target:
          description: "Drop zone"
          hint: '.drop-zone'
        expected:
          exists: true

      - action: observe
        target:
          description: "Instructions visible"
          hint: '.instructions'
        expected:
          exists: true

      - action: axe
        expected:
          maxViolations: 0
          wcagLevel: "AA"

    spiritChecks:
      - "Drop zone is clearly visible and inviting"
      - "Upload icon and text are easy to understand"
      - "File type restrictions are clearly communicated"
      - "Maximum file size is prominently displayed"

  # ==========================================================================
  # User Interactions - Single File Upload
  # ==========================================================================
  - id: "upload-svelte/single-file/upload-single"
    sampleId: "single-file"
    severity: "error"

    intent: "Validates single file upload with file selection"

    notes:
      - "Sample has maxFiles: 1"
      - "Should allow file selection and display in list"
      - "Session should update with file metadata"

    steps:
      - action: navigate
        path: "/upload"
        params:
          sampleId: "single-file"

      - action: uploadFile
        target:
          description: "File input"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "File appears in list"
          hint: '.file-item'
        expected:
          exists: true

      - action: observe
        target:
          description: "File name displayed"
          hint: 'text="sample-document.pdf"'
        expected:
          exists: true

    spiritChecks:
      - "File uploads smoothly without lag"
      - "File name and size are displayed clearly"
      - "Remove button is accessible"

  # ==========================================================================
  # User Interactions - Multiple File Upload
  # ==========================================================================
  - id: "upload-svelte/default/upload-multiple"
    sampleId: "default"
    severity: "error"

    intent: "Validates multiple file upload capability"

    notes:
      - "Sample has maxFiles: 3"
      - "Should allow multiple file selections"
      - "File count should update"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "File input"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-1.pdf"

      - action: wait
        timeout: 500

      - action: uploadFile
        target:
          description: "File input"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-2.pdf"

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "Two files in list"
          hint: '.file-item'
        expected:
          exists: true

      - action: observe
        target:
          description: "File count indicator"
          hint: '.file-count'
        expected:
          contains: "2"

  # ==========================================================================
  # User Interactions - File Removal
  # ==========================================================================
  - id: "upload-svelte/default/remove-file"
    sampleId: "default"
    severity: "error"

    intent: "Validates file removal functionality"

    notes:
      - "Sample has allowReplace: true"
      - "Should allow removing uploaded files"
      - "File count and list should update"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "Remove button"
          hint: '.remove-button'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "File removed from list"
          hint: '.file-item'
        expected:
          exists: false

  # ==========================================================================
  # Validation - File Size Limit
  # ==========================================================================
  - id: "upload-svelte/default/validate-file-size"
    sampleId: "default"
    severity: "error"

    intent: "Validates file size validation rejects oversized files"

    notes:
      - "Sample has maxFileSize: 5242880 (5MB)"
      - "Should reject files larger than limit"
      - "Should show error message"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "File input"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/large-file-10mb.pdf"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Error message displayed"
          hint: '.error-message'
        expected:
          exists: true

      - action: observe
        target:
          description: "Error mentions size limit"
          hint: 'text="exceeds maximum size"'
        expected:
          exists: true

    spiritChecks:
      - "Error message is clear and actionable"
      - "User understands what went wrong"
      - "File is not added to list"

  # ==========================================================================
  # Validation - File Type Restriction
  # ==========================================================================
  - id: "upload-svelte/default/validate-file-type"
    sampleId: "default"
    severity: "error"

    intent: "Validates file type validation rejects invalid types"

    notes:
      - "Sample has acceptedTypes: ['image/*', '.pdf', '.txt', '.doc', '.docx']"
      - "Should reject files not matching accepted types"
      - "Should show error message"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "File input"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/invalid-type.exe"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Error message displayed"
          hint: '.error-message'
        expected:
          exists: true

      - action: observe
        target:
          description: "Error mentions invalid type"
          hint: 'text="invalid type"'
        expected:
          exists: true

    spiritChecks:
      - "Error clearly states accepted file types"
      - "User knows what types are allowed"

  # ==========================================================================
  # Validation - Maximum File Count
  # ==========================================================================
  - id: "upload-svelte/default/validate-max-files"
    sampleId: "default"
    severity: "error"

    intent: "Validates maximum file count restriction"

    notes:
      - "Sample has maxFiles: 3"
      - "Should prevent uploading more than maximum"
      - "Drop zone should become disabled at maximum"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file 1"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/file-1.pdf"

      - action: wait
        timeout: 500

      - action: uploadFile
        target:
          description: "Upload file 2"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/file-2.pdf"

      - action: wait
        timeout: 500

      - action: uploadFile
        target:
          description: "Upload file 3"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/file-3.pdf"

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "File input disabled at max"
          hint: 'input[type="file"][disabled]'
        expected:
          exists: true

      - action: observe
        target:
          description: "Maximum reached message"
          hint: 'text="Maximum number of files"'
        expected:
          exists: true

  # ==========================================================================
  # Configuration - Image Preview
  # ==========================================================================
  - id: "upload-svelte/default/image-preview"
    sampleId: "default"
    severity: "error"

    intent: "Validates image preview display when showPreview enabled"

    notes:
      - "Sample has showPreview: true"
      - "Should display thumbnail for image files"
      - "Preview should be visible in file list"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload image"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-image.jpg"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Image preview rendered"
          hint: '.file-preview'
        expected:
          exists: true

      - action: observe
        target:
          description: "Preview is img element"
          hint: 'img.file-preview'
        expected:
          exists: true

    spiritChecks:
      - "Image preview renders correctly"
      - "Thumbnail size is appropriate"
      - "Preview doesn't distort image aspect ratio"

  # ==========================================================================
  # Configuration - Single File Mode
  # ==========================================================================
  - id: "upload-svelte/single-file/single-mode"
    sampleId: "single-file"
    severity: "error"

    intent: "Validates single file mode configuration"

    notes:
      - "Sample has maxFiles: 1, minFiles: 1"
      - "Should only allow one file"
      - "File input should not have multiple attribute"

    steps:
      - action: navigate
        path: "/upload"
        params:
          sampleId: "single-file"

      - action: observe
        target:
          description: "File input without multiple"
          hint: 'input[type="file"]:not([multiple])'
        expected:
          exists: true

      - action: uploadFile
        target:
          description: "Upload first file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/document.pdf"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "File input disabled"
          hint: 'input[type="file"][disabled]'
        expected:
          exists: true

  # ==========================================================================
  # Modes - View Mode
  # ==========================================================================
  - id: "upload-svelte/default/view-mode"
    sampleId: "default"
    severity: "error"

    intent: "Validates view mode displays uploaded files without allowing changes"

    notes:
      - "Should show uploaded files"
      - "Upload controls should be hidden or disabled"
      - "No remove buttons visible"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "View mode"
          hint: 'input[name="mode"][value="view"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "File still visible"
          hint: '.file-item'
        expected:
          exists: true

      - action: observe
        target:
          description: "Remove button hidden"
          hint: '.remove-button'
        expected:
          exists: false

      - action: observe
        target:
          description: "Drop zone disabled"
          hint: '.drop-zone.disabled'
        expected:
          exists: true

  # ==========================================================================
  # Modes - Evaluate Mode (Complete)
  # ==========================================================================
  - id: "upload-svelte/default/evaluate-complete"
    sampleId: "default"
    severity: "error"

    intent: "Validates evaluate mode shows complete when minimum files uploaded"

    notes:
      - "Sample has minFiles: 1"
      - "Should show 'complete' indicator when requirement met"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Complete indicator"
          hint: '.response-indicator.complete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Status shows complete"
          hint: 'text="Complete"'
        expected:
          exists: true

  # ==========================================================================
  # Modes - Evaluate Mode (Incomplete)
  # ==========================================================================
  - id: "upload-svelte/default/evaluate-incomplete"
    sampleId: "default"
    severity: "error"

    intent: "Validates evaluate mode shows incomplete when minimum files not met"

    notes:
      - "Don't upload any files"
      - "Should show 'incomplete' indicator"

    steps:
      - action: navigate
        path: "/upload"

      - action: click
        target:
          description: "Evaluate mode without uploading"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Incomplete indicator"
          hint: '.response-indicator.incomplete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Status shows incomplete"
          hint: 'text="Incomplete"'
        expected:
          exists: true

  # ==========================================================================
  # Modes - Instructor Rationale
  # ==========================================================================
  - id: "upload-svelte/default/instructor-rationale"
    sampleId: "default"
    severity: "error"

    intent: "Validates instructor role displays rationale in evaluate mode"

    notes:
      - "Sample has rationaleEnabled: true"
      - "Rationale should only show for instructor role"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: click
        target:
          description: "Instructor role"
          hint: 'input[name="role"][value="instructor"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Rationale section visible"
          hint: '.rationale'
        expected:
          exists: true

  # ==========================================================================
  # Accessibility - Keyboard Navigation
  # ==========================================================================
  - id: "upload-svelte/default/keyboard-navigation"
    sampleId: "default"
    severity: "error"

    intent: "Validates full keyboard navigation support"

    notes:
      - "Must be navigable with Tab key"
      - "Enter/Space should trigger file dialog"
      - "Focus indicators must be visible"

    steps:
      - action: navigate
        path: "/upload"

      - action: observe
        target:
          description: "Drop zone is focusable"
          hint: '.drop-zone[tabindex="0"]'
        expected:
          exists: true

      - action: axe
        expected:
          maxViolations: 0
          wcagLevel: "AA"

    spiritChecks:
      - "Tab key focuses the drop zone"
      - "Enter key opens file dialog"
      - "Focus indicators are clearly visible"
      - "Remove buttons are keyboard accessible"
      - "No keyboard traps"

  # ==========================================================================
  # Accessibility - ARIA Attributes
  # ==========================================================================
  - id: "upload-svelte/default/aria-attributes"
    sampleId: "default"
    severity: "error"

    intent: "Validates proper ARIA attributes for accessibility"

    notes:
      - "Drop zone should have button role"
      - "File list should have list role"
      - "Status updates should use live regions"

    steps:
      - action: navigate
        path: "/upload"

      - action: observe
        target:
          description: "Drop zone with button role"
          hint: '.drop-zone[role="button"]'
        expected:
          exists: true

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "File list with list role"
          hint: '.files-list[role="list"]'
        expected:
          exists: true

      - action: observe
        target:
          description: "File items with listitem role"
          hint: '.file-item[role="listitem"]'
        expected:
          exists: true

    spiritChecks:
      - "Screen readers announce upload status"
      - "File additions/removals are announced"
      - "Error messages are announced immediately"

  # ==========================================================================
  # Error Handling - No Files Uploaded
  # ==========================================================================
  - id: "upload-svelte/default/no-upload"
    sampleId: "default"
    severity: "error"

    intent: "Validates graceful handling when no files uploaded"

    notes:
      - "User switches to evaluate mode without uploading"
      - "Should handle empty session gracefully"
      - "Should show incomplete status"
      - "No JavaScript errors"

    steps:
      - action: navigate
        path: "/upload"

      - action: click
        target:
          description: "Evaluate mode without uploading"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 1000

      - action: observe
        target:
          description: "Incomplete indicator"
          hint: '.response-indicator.incomplete'
        expected:
          exists: true

      - action: observe
        target:
          description: "Element renders without error"
          hint: '.pie-upload'
        expected:
          exists: true

  # ==========================================================================
  # State Management - Mode Switching
  # ==========================================================================
  - id: "upload-svelte/default/mode-switching"
    sampleId: "default"
    severity: "error"

    intent: "Validates smooth transitions between modes"

    notes:
      - "Should switch between gather, view, evaluate modes"
      - "Uploaded files should persist"
      - "No visual glitches or errors"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "View mode"
          hint: 'input[name="mode"][value="view"]'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "File persists"
          hint: '.file-item'
        expected:
          exists: true

      - action: click
        target:
          description: "Evaluate mode"
          hint: 'input[name="mode"][value="evaluate"]'

      - action: wait
        timeout: 500

      - action: click
        target:
          description: "Back to gather"
          hint: 'input[name="mode"][value="gather"]'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "Element stable"
          hint: '.pie-upload'
        expected:
          exists: true

  # ==========================================================================
  # State Management - Reset Functionality
  # ==========================================================================
  - id: "upload-svelte/default/reset"
    sampleId: "default"
    severity: "error"

    intent: "Validates reset button clears uploaded files and returns to initial state"

    steps:
      - action: navigate
        path: "/upload"

      - action: uploadFile
        target:
          description: "Upload file"
          hint: 'input[type="file"]'
        filePath: "test-fixtures/sample-document.pdf"

      - action: wait
        timeout: 1000

      - action: click
        target:
          description: "Reset button"
          hint: 'button:has-text("Reset")'

      - action: wait
        timeout: 500

      - action: observe
        target:
          description: "Files cleared"
          hint: '.file-item'
        expected:
          exists: false

      - action: observe
        target:
          description: "Drop zone re-enabled"
          hint: '.drop-zone:not(.disabled)'
        expected:
          exists: true

  # ==========================================================================
  # Performance - Initial Load
  # ==========================================================================
  - id: "upload-svelte/default/load-performance"
    sampleId: "default"
    severity: "warn"

    intent: "Validates element loads and renders within acceptable time"

    notes:
      - "Target: < 2s to interactive"
      - "Measured from navigation to visible element"

    steps:
      - action: navigate
        path: "/upload"

      - action: wait
        condition: "networkidle"

      - action: observe
        target:
          description: "Element rendered"
          hint: '.pie-upload'
        expected:
          exists: true

  # ==========================================================================
  # Style & Visual - Color Contrast
  # ==========================================================================
  - id: "upload-svelte/default/style-color-contrast"
    sampleId: "default"
    severity: "error"

    intent: "Validates text color contrast meets WCAG 2.2 Level AA standards"

    notes:
      - "WCAG 2.2 AA: Normal text requires 4.5:1 contrast ratio"

    steps:
      - action: navigate
        path: "/upload"

      - action: checkColorContrast
        target:
          description: "Prompt text"
          hint: '.prompt'
        expected:
          ratio:
            greaterThanOrEqual: 4.5

      - action: checkColorContrast
        target:
          description: "Drop zone text"
          hint: '.drop-text'
        expected:
          ratio:
            greaterThanOrEqual: 4.5

    spiritChecks:
      - "All text is easily readable"
      - "Drop zone has clear visual contrast"
      - "File names are legible"

  # ==========================================================================
  # Style & Visual - Visual Regression Baseline
  # ==========================================================================
  - id: "upload-svelte/default/style-visual-regression"
    sampleId: "default"
    severity: "warn"

    intent: "Creates visual regression baseline for gather mode"

    notes:
      - "Captures screenshot for future comparisons"
      - "Helps detect unintended visual changes"

    steps:
      - action: navigate
        path: "/upload"

      - action: screenshot
        target:
          description: "Upload element in gather mode"
          hint: '.pie-upload'
        name: "upload-svelte-default-gather"

    spiritChecks:
      - "Element renders consistently"
      - "No unexpected layout shifts"
      - "Drop zone styling is appealing"
